# 第二十三章 缓存

## 23.1 离线检测

1. navagator.onLine
2. window 的离线在线事件
   （1）online 触发
   （2）offline 触发

# 第 24 章 最佳实践

## 24.1 可维护性

1. 什么是可维护性
   （1）可理解：无需他人解释就可以理解代码意图
   （2）直观性：不管操作多复杂，一看就懂
   （3）可适应性：数据上的变化无需重写
   （4）可拓展：架构上考虑未来，核心可拓展
   （5）可调试：错误提示
2. 代码约定
   （1）可读性：缩进和注释
   （2）变量和函数名：变量名词、函数名动词
   （3）变量类型透明：加类型前缀或者使用强类型语言 ts
3. 松散耦合
   （1）解藕 html 和 js，不要使用内部 script 标签或者事件调用，单独写 js 文件，
   （2）js 与 css：动态修改样式类而不是直接修改样式
   （3）应用逻辑和事件处理程序：一个事件处理程序应该从事件对象中提取相关信息，并将这些信息传达到处理应用逻辑的某个方法中；应用和业务逻辑松散的几条原则：

- 不要将 event 对象传递给其他方法，只传来自 event 对象中所需的数据
- 任何可以在应用层面的动作都应该可以在不执行任何事件处理程序的情况下进行
- 任何事件处理程序都应该处理事件，然后将处理转交给应用逻辑

4. 编程实践
   （1）尊重对象所有权：不是你维护的对象，不要再原型上添加新的属性或者方法，也不要重写方法

- 创建包含所需功能的新对象，并用它与相关对象进行交互、
- 创建自定义类型，继承需要修改的类型，可以对自定义类型添加额外功能
  （2）避免全局量：最多创建一个全局变量，所有的函数和对象都包含在它里面；将功能组合在一个对象叫做命名空间；命名空间可以保证代码在同一个页面上与其他代码以无害的方式一起工作
  （3）避免与 null 比较：
- 引用类型使用 instanceof 检测构造函数
- 基础类型使用 typeof
- 希望对象包含特定方法名，typeof 指定特定名字的方法存在于对象上
  （4）使用常量：随着应用成长而具有改变倾向的数据都应该提出来作为常量，将数据和使用它的逻辑分离，要注意的值的类型如下：
- 重复值：包含 css 类名
- 用户界面字符串：抽离待国际化
- URLs：推荐使用公共的地方存放所有 URL
- 任意可能会改变的值：每当用到子面量值的时候都询问是否可能会改变而决定是否抽离

## 24.2 性能

1. 注意作用域
   （1）避免全局查找：将一个函数中会用到多次的全局对象存储为局部对象可以减少全局作用域链的查找次数
   （2）避免 with 语句：with 语句主要用于消除额外的字符串，会创建新的作用域，增长作用域链
2. 选择正确的方法：
   （1）避免不必要的查找属性：重复的属性查找储存到变量中，如果可以使用数字化的数组位置访问，也可以使用命名属性，那么使用数字位置，数组查找为 o(1),对象查找为 o(n)
   （2）优化循环：

- 减值迭代：值递减
- 简化终止条件，比如将 arr.length 赋值给 len，就不用计算多次
- 简化循环体：能移出循环体的记得移出
- 使用后测试循环：do...while
  （3）展开循环：当循环的个数不多时，直接调用会比循环快，省去了建立循环和处理终止条件的开销，展开循环可以提高大数据集的处理速度
  （4）避免双重解释：eval、Function、setTimeout 等传入字符串需要创建新的解释器，会比直接解析慢很多
  （5）性能的其他注意事项：
- 使用原生的方法：都是 c 或者 c++写的，会比自己用 js 写的更快
- switch 语句比 if else 更便捷，还可以根据情况将概率大的写前面

3. 最小语句数
   （1）声明放在一起，使用以一次声明语句
   （2）插入迭代值：自增后缀操作，值只在其他部分结束之后才会增加
4. 优化 dom 交互
   （1）最小化现场更新：要访问的 dom 已经显示在页面中，就是现场更新；使用文档片段来构建 dom，在插入文档，document.createDocumentFragment，片段本身不会被添加
   （2）使用 innerHTML 在大 dom 插入时比 createElement 和 appendChild 快，记得减少现场更新，拼接好字符串一次性 innerHTML
   （3）使用事件代理
   （4）⚠️HTMLCollection：访问上面的属性或者方法都是昂贵的开销，要尽量减少访问次数；何时会访问 HTMLCollection：

- 进行了 getElementsByTagName 调用
- 获取元素的 childNodes 属性
- 获取 attributes 属性
- 访问特殊集合 document.forms、document.images 等

## 24.3 部署

1. http 请求是 web 中主要的性能瓶颈，减少 script 文件数量
2. 构建（将 js 合并为较少文件）-验证-压缩

## 24.4 小结

1. js 定义行为、css 定义外观、html 定义内容，互不影响

# 第二十五章 新兴 API

（1）创建平滑的动画
（2）操作文件
（3）使用 web workers 在后台执行 js

## 25.1 requestAnimationFrame

（1）requestAnimationFrame 是浏览器用于定时循环操作的一个接口，类似于 setTimeout，主要用途是按帧对网页进行重绘。
（2）传入回调函数会在重绘之前调用
（3）主要应用场景在帧动画中优化性能

## 25.2 Page Visibility API

1. 页面可见性 API，主要三部分：

- document.hidden: 页面是否隐藏的布尔值，包括在后台标签页或最小化
- document.visibilityState 有四个状态值：页面在后台标签或最小化；在前台标签；页面已经隐藏，可以看到预览；页面在屏幕外预渲染（兼容性堪忧，建议使用 hidden）
- visibilitychange 事件：文档可见预不可见间转换触发

## 25.3 Geolocation API

1. 在浏览器中的实现是 navigator.geolocation 对象，包含三个方法
   （1）getCurrentPosition：会触发请求用户地理位置提示，接受三个参数：成功回调、可选失败回调、可选的选项对象；其中成功回调会接受到一个 position 对象参数，有两个属性 coords 和 timestamp，而 coords 中包含以下与位置相关的信息
   （2）失败回调也接受一个参数对象：包含 message 和 code 两个属性，message 是为什么报错的文本，code 保存数值：1.拒绝，2.位置无效，3.超时
   （3）第三个选项对象用于设置信息的类型：可以设置的选项有三个 enableHighAccuracy（布尔值，表示尽可能使用最准确的信息）；timeout（等待位置信息的最长时间）；maximumAge（上一次获得的坐标信息的有效时间，时间到则重新获取）
2. watchPosition 用于跟踪用户位置参数与上面完全相同，与定时调用 getCurrentPosition 效果相同
3. clearWatch 取消跟踪
